<!DOCTYPE html>
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <meta name="baidu-site-verification" content="fk7KxxZA62" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>
      jetty-maven-plugin静态文件保存不了
    </title>
    <!--
    <link rel="shortcut icon" type="image/x-icon" href="/static/images/favicon.ico" media="screen" />
     -->
    <!-- Bootstrap Core CSS -->
    <link href="/static/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="/static/css/blog.css" rel="stylesheet">
    <link href="/static/css/pygments.css" rel="stylesheet">
    <script src="/static/js/jquery-1.11.0.js"></script>
    <script src="/static/bootstrap/js/bootstrap.min.js"></script>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media
    queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file://
    -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js">
      </script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js">
      </script>
    <![endif]-->
    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "//hm.baidu.com/hm.js?4a7b2b2a1ee8b8686ec632c195bbd833";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    </script>
  </head>
  
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top " role="navigation">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <a class="navbar-brand " href="/" >妙音</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li><a href="/categories.html">分 类</a></li>
                <li><a href="/fofa.html">学佛</a></li>
                <li><a href="/tools.html">工具</a></li>
            </ul>
            <form class="navbar-form navbar-right" role="search" action="https://www.google.com/search" method="get">
              <div class="input-group">
                <input type="text" name="q" class="form-control search-query" placeholder="搜索">
                <input type="hidden" name="ie" value="UTF-8" />
                <input type="hidden" name="sitesearch" value="www.zhulinjingshe.cn" />
              </div>
            </form>
        </div>
      </div>
    </nav>

    <!-- Page Content -->
    <div class="container">
      <div class="content">
          <div class="row">
            <!-- Blog Post -->
<!-- Title -->
<h2>
  jetty-maven-plugin静态文件保存不了
  <div class="post-date">
        妙音 posted @
        <span class="glyphicon glyphicon-time"></span>
        2014-12-31 11:11
        in jetty with tags maven
  </div>
</h2>
<!-- Author -->
<hr>

<div class="col-md-10">
    <h2>起因</h2>

<p>为maven项目配置jetty-maven-plugin插件，以jetty:run方式运行，会出现静态文件保存不了的问题。原因是jetty内存映射文件来缓存静态文件. 解决方法是将jetty内存映射参数取消掉.</p>

<h2>解决</h2>

<ul>
<li><strong>找webdefault.xml文件</strong><br>
在下面路径找到webdefault.xml文件</li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\.</span>m2<span class="se">\r</span>epository<span class="se">\o</span>rg<span class="se">\e</span>clipse<span class="se">\j</span>etty<span class="se">\j</span>etty-webapp<span class="se">\9</span>.2.6.v20141205</code></pre></div>

<p>如果安装了jetty服务器，在它的etc目录下也可以取到webdefault.xml文件</p>

<ul>
<li><strong>useFileMappedBuffer参数值改为false</strong><br>
webdefault.xml配置</li>
</ul>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;init-param&gt;</span>
  <span class="nt">&lt;param-name&gt;</span>useFileMappedBuffer<span class="nt">&lt;/param-name&gt;</span>
  <span class="nt">&lt;param-value&gt;</span>false<span class="nt">&lt;/param-value&gt;</span>
<span class="nt">&lt;/init-param&gt;</span></code></pre></div>

<ul>
<li><strong>新增defaultsDescriptor配置项</strong><br></li>
</ul>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;plugin&gt;</span>  
    <span class="nt">&lt;groupId&gt;</span>org.eclipse.jetty<span class="nt">&lt;/groupId&gt;</span>  
    <span class="nt">&lt;artifactId&gt;</span>jetty-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>  
    <span class="nt">&lt;version&gt;</span>9.2.6.v20141205<span class="nt">&lt;/version&gt;</span>  
    <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;scanIntervalSeconds&gt;</span>0<span class="nt">&lt;/scanIntervalSeconds&gt;</span>
        <span class="nt">&lt;webAppSourceDirectory&gt;</span>${basedir}/WebRoot<span class="nt">&lt;/webAppSourceDirectory&gt;</span>
        <span class="nt">&lt;webApp&gt;</span>  
            <span class="nt">&lt;contextPath&gt;</span>/<span class="nt">&lt;/contextPath&gt;</span>
            <span class="nt">&lt;war&gt;</span>${project.build.directory}/${project.build.finalName}.war<span class="nt">&lt;/war&gt;</span>
            <span class="c">&lt;!-- jetty9.2.6的defaultsDescriptor在&lt;webApp&gt;里，早期版本在&lt;configuration&gt;或者&lt;webAppConfig&gt;里 --&gt;</span>
            <span class="nt">&lt;defaultsDescriptor&gt;</span>${basedir}/WebRoot/resources/webdefault.xml<span class="nt">&lt;/defaultsDescriptor&gt;</span>
        <span class="nt">&lt;/webApp&gt;</span> 
    <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span></code></pre></div>

<ul>
<li><strong>webdefault.xml加载是否成功</strong><br>
控制台输出如下，表示加载了webdefualt.xml</li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>INFO<span class="o">]</span> Web <span class="nv">defaults</span> <span class="o">=</span> .... /WebRoot/resources/webdefault.xml</code></pre></div>

<h2>感受</h2>

<p>上面方法虽然可以解决问题，但是很不好用. 如果jetty-maven-plugin能设计个开发模式设置，在易用性上会有更大提升.</p>

<h2>参考资料</h2>

<ul>
<li>jetty-maven-plugin配置文档
<a href="http://eclipse.org/jetty/documentation/current/jetty-maven-plugin.html" target="_blank">http://eclipse.org/jetty/documentation/current/jetty-maven-plugin.html</a></li>
<li>maven文档
<a href="http://mvnrepository.com/artifact/org.eclipse.jetty/jetty-maven-plugin/9.2.6.v20141205" target="_blank">http://mvnrepository.com/artifact/org.eclipse.jetty/jetty-maven-plugin/9.2.6.v20141205</a></li>
</ul>

    <br/>
    <div style="margin-top:10px;margin-bottom:10px">
      
      <span class="next">
        上篇：
        <a href="/ssh/2014/12/13/ssh.html">
          PTY allocation request failed on channel 0 是什么意思？
        </a>
      </span>
       
      
      <span class="prev">
        下篇：
        <a href="/html/2015/01/05/html.html">
          <img>加载图片失败，怎样替换为默认图片
        </a>
      </span>
      
    </div>
    <hr>
    <!-- Blog Comments -->
    <div class="media">
        <!-- UY BEGIN -->
        <div id="uyan_frame"></div>
        <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1965284"></script>
        <!-- UY END -->
    </div>
</div>

          </div>
      </div>
      <!-- Footer -->
      <footer>
        <div class="row">
          <div class="col-lg-12">
            <p align="center"></p>
          </div>
        </div>
      </footer>
    </div>
    <script src="/static/js/blog.js"></script>
  </body>
</html>

