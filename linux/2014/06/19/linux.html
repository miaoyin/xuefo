<!DOCTYPE html>
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <meta name="baidu-site-verification" content="fk7KxxZA62" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>
      linux与linux之间共享目录
    </title>
    <!--
    <link rel="shortcut icon" type="image/x-icon" href="/static/images/favicon.ico" media="screen" />
     -->
    <!-- Bootstrap Core CSS -->
    <link href="/static/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="/static/css/blog.css" rel="stylesheet">
    <link href="/static/css/pygments.css" rel="stylesheet">
    <script src="/static/js/jquery-1.11.0.js"></script>
    <script src="/static/bootstrap/js/bootstrap.min.js"></script>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media
    queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file://
    -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js">
      </script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js">
      </script>
    <![endif]-->
    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "//hm.baidu.com/hm.js?4a7b2b2a1ee8b8686ec632c195bbd833";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    </script>
  </head>
  
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top " role="navigation">
      <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <a class="navbar-brand " href="/" >妙音</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li><a href="/categories.html">分 类</a></li>
                <li><a href="/fofa.html">学佛</a></li>
                <li><a href="/tools.html">工具</a></li>
            </ul>
            <form class="navbar-form navbar-right" role="search" action="https://www.google.com/search" method="get">
              <div class="input-group">
                <input type="text" name="q" class="form-control search-query" placeholder="搜索">
                <input type="hidden" name="ie" value="UTF-8" />
                <input type="hidden" name="sitesearch" value="www.zhulinjingshe.cn" />
              </div>
            </form>
        </div>
      </div>
    </nav>

    <!-- Page Content -->
    <div class="container">
      <div class="content">
          <div class="row">
            <!-- Blog Post -->
<!-- Title -->
<h2>
  linux与linux之间共享目录
  <div class="post-date">
        妙音 posted @
        <span class="glyphicon glyphicon-time"></span>
        2014-06-19 22:46
        in linux with tags mount共享目录
  </div>
</h2>
<!-- Author -->
<hr>

<div class="col-md-10">
    <h2>简述</h2>

<p>在linux与windows之间共享目录使用smbfs. 但是在linux与linux之间共享目录要用nfs(Network File System网络文件系统). 服务端用nfs提供共享目录服务，客户端通过mount将共享目录挂载到本地.  </p>

<p>以fedora 20设置共享目录为例</p>

<ul>
<li>安装nfs
fedora 20要安装以下两个包</li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>wyq@localhost ~<span class="o">]</span><span class="nv">$ </span>rpm -qa <span class="p">|</span>grep nfs
libnfsidmap-0.25-8.fc20.x86_64
nfs-utils-1.3.0-2.1.fc20.x86_64</code></pre></div>

<ul>
<li>配置共享目录
在/etc/exports文件中添加以下内容</li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">/home/wyq/share  192.* <span class="o">(</span>insecure,rw,sync,no_root_squash<span class="o">)</span></code></pre></div>

<ul>
<li><p>设置防火墙，允许nfs服务
输入sudo firewall-config打开防火墙配置界面，选中nfs服务
<img src="http://miaoyin.qiniudn.com/2014-06-19-linux.png" width="800" hight="350"/></p></li>
<li><p>启动nfs服务</p></li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo service nfs start</code></pre></div>

<ul>
<li>挂载目录</li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo mount -t nfs 127.0.0.1:/home/wyq/share /home/wyq/mount</code></pre></div>

<ul>
<li>取消挂载</li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">umount /home/wyq/mount</code></pre></div>

<h2>exports配置文件说明</h2>

<p>/home/wyq/share 共享的目录<br>
192.*           允许访问的主机IP, 如果不能确定 ,请使用 *(在fedora 20实验中表示任意IP时，不用加星号，否则nfs会无法启动)<br>
insecure        一个安全选项, 如果nfs服务端口号小于1024则可以不添加这个选项, 否则不添加的话, 是无法访问的.其他主机访问的话就会被拒绝.<br>
rw              共享目录的权限,rw 是可读写的权限,只读的权限是ro.<br>
sync            同步的选项, 可选的还有 async. sync是不使用缓存,随时写入同步, async是使用缓存的.<br>
no<em>root</em>squash  NFS服务共享的目录的属性, 如果用户是root, 那么对这个目录就有root的权限.  </p>

<h2>启动nfs失败示例</h2>

<ul>
<li>启动nfs时提示失败</li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>wyq@localhost workspace<span class="o">]</span><span class="nv">$ </span>sudo service nfs start
Redirecting to /bin/systemctl start  nfs.service
Job <span class="k">for</span> nfs-server.service failed. See <span class="s1">&#39;systemctl status nfs-server.service&#39;</span> and <span class="s1">&#39;journalctl -xn&#39;</span> <span class="k">for</span> details.</code></pre></div>

<ul>
<li>根据提示查看错误信息</li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="o">[</span>wyq@localhost workspace<span class="o">]</span><span class="nv">$ </span>sudo systemctl status nfs-server.service
nfs-server.service - NFS Server
   Loaded: loaded <span class="o">(</span>/usr/lib/systemd/system/nfs-server.service<span class="p">;</span> disabled<span class="o">)</span>
   Active: failed <span class="o">(</span>Result: <span class="nb">exit</span>-code<span class="o">)</span> since 四 2014-06-19 22:20:37 CST<span class="p">;</span> 5s ago
  Process: <span class="m">4984</span> <span class="nv">ExecStopPost</span><span class="o">=</span>/usr/sbin/exportfs -f <span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited, <span class="nv">status</span><span class="o">=</span>0/SUCCESS<span class="o">)</span>
  Process: <span class="m">4980</span> <span class="nv">ExecStop</span><span class="o">=</span>/usr/sbin/rpc.nfsd <span class="m">0</span> <span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited, <span class="nv">status</span><span class="o">=</span>0/SUCCESS<span class="o">)</span>
  Process: <span class="m">3778</span> <span class="nv">ExecStartPost</span><span class="o">=</span>/usr/libexec/nfs-utils/scripts/nfs-server.postconfig <span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited, <span class="nv">status</span><span class="o">=</span>0/SUCCESS<span class="o">)</span>
  Process: <span class="m">3761</span> <span class="nv">ExecStart</span><span class="o">=</span>/usr/sbin/rpc.nfsd <span class="nv">$RPCNFSDARGS</span> <span class="nv">$RPCNFSDCOUNT</span> <span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited, <span class="nv">status</span><span class="o">=</span>0/SUCCESS<span class="o">)</span>
  Process: <span class="m">5371</span> <span class="nv">ExecStartPre</span><span class="o">=</span>/usr/sbin/exportfs -r <span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited, <span class="nv">status</span><span class="o">=</span>1/FAILURE<span class="o">)</span>
  Process: <span class="m">5369</span> <span class="nv">ExecStartPre</span><span class="o">=</span>/usr/libexec/nfs-utils/scripts/nfs-server.preconfig <span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited, <span class="nv">status</span><span class="o">=</span>0/SUCCESS<span class="o">)</span>
 Main PID: <span class="m">3761</span> <span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited, <span class="nv">status</span><span class="o">=</span>0/SUCCESS<span class="o">)</span>
 
6月 <span class="m">19</span> 22:20:37 localhost.localdomain systemd<span class="o">[</span>1<span class="o">]</span>: Starting NFS Server...
6月 <span class="m">19</span> 22:20:37 localhost.localdomain exportfs<span class="o">[</span>5371<span class="o">]</span>: exportfs: No options <span class="k">for</span> /home/wyq/share *: suggest *<span class="o">(</span>sync<span class="o">)</span> to avoid warning
6月 <span class="m">19</span> 22:20:37 localhost.localdomain exportfs<span class="o">[</span>5371<span class="o">]</span>: exportfs: No host name given with /home/wyq/share <span class="o">(</span>insecure,rw,sync,no_root_squash<span class="o">)</span>, suggest *<span class="o">(</span>insecure,rw,sync,no_root_squash<span class="o">)</span> to avoid warning
6月 <span class="m">19</span> 22:20:37 localhost.localdomain exportfs<span class="o">[</span>5371<span class="o">]</span>: exportfs: incompatible duplicated <span class="nb">export </span>entries:
6月 <span class="m">19</span> 22:20:37 localhost.localdomain exportfs<span class="o">[</span>5371<span class="o">]</span>: exportfs:         *:/home/wyq/share <span class="o">(</span>0x422<span class="o">)</span> <span class="o">[</span>IGNORED<span class="o">]</span>
6月 <span class="m">19</span> 22:20:37 localhost.localdomain exportfs<span class="o">[</span>5371<span class="o">]</span>: exportfs:         *:/home/wyq/share <span class="o">(</span>0x425<span class="o">)</span>
6月 <span class="m">19</span> 22:20:37 localhost.localdomain systemd<span class="o">[</span>1<span class="o">]</span>: nfs-server.service: control process exited, <span class="nv">code</span><span class="o">=</span>exited <span class="nv">status</span><span class="o">=</span>1
6月 <span class="m">19</span> 22:20:37 localhost.localdomain systemd<span class="o">[</span>1<span class="o">]</span>: Failed to start NFS Server.
6月 <span class="m">19</span> 22:20:37 localhost.localdomain systemd<span class="o">[</span>1<span class="o">]</span>: Unit nfs-server.service entered failed state.</code></pre></div>

<p>注意到信息中&quot;exportfs: incompatible duplicated export entries:&quot; 意思是有重复配置</p>

<ul>
<li>查看配置文件/etc/exports, 内容如下</li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">/home/wyq/share  *  <span class="o">(</span>insecure,rw,sync,no_root_squash<span class="o">)</span></code></pre></div>

<ul>
<li>猜测是配置错误导致nfs无法启动
将配置更改为以下几种，逐一尝试
第一种</li>
</ul>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">/home/wyq/share  192.*  <span class="o">(</span>insecure,rw,sync,no_root_squash<span class="o">)</span></code></pre></div>

<p>第二种</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">/home/wyq/share  <span class="o">(</span>insecure,rw,sync,no_root_squash<span class="o">)</span></code></pre></div>

<p>发现使用以上两种方式的配置，nfs均能正常启动并且被挂载.</p>

<ul>
<li>结论
在fedora 20的nfs配置文件/etc/exports中，如果想让任意主机访问共享目录，不需要用*表示，不填即表示任意主机.</li>
</ul>

    <br/>
    <div style="margin-top:10px;margin-bottom:10px">
      
      <span class="next">
        上篇：
        <a href="/postgres/2014/06/17/postgres.html">
          postgres复制表结构
        </a>
      </span>
       
      
      <span class="prev">
        下篇：
        <a href="/js/2014/06/25/js.html">
          web前端开发包管理器bower[笔记]
        </a>
      </span>
      
    </div>
    <hr>
    <!-- Blog Comments -->
    <div class="media">
        <!-- UY BEGIN -->
        <div id="uyan_frame"></div>
        <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1965284"></script>
        <!-- UY END -->
    </div>
</div>

          </div>
      </div>
      <!-- Footer -->
      <footer>
        <div class="row">
          <div class="col-lg-12">
            <p align="center"></p>
          </div>
        </div>
      </footer>
    </div>
    <script src="/static/js/blog.js"></script>
  </body>
</html>

